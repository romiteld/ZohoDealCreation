# Well Intake API Environment Configuration Template
# Copy this file to .env.local and fill in your values
# IMPORTANT: Never commit .env.local to version control

# ====================
# Core Configuration
# ====================
ENVIRONMENT=development
API_KEY=your-secure-api-key-here
USE_LANGGRAPH=true  # CRITICAL: Must be true for LangGraph workflow

# ====================
# Azure Key Vault (Production)
# ====================
KEY_VAULT_URL=https://your-keyvault.vault.azure.net/
USE_MANAGED_IDENTITY=false  # Set to true in production
# For local development, Azure CLI auth will be used

# ====================
# Application Insights & Monitoring
# ====================
APPLICATIONINSIGHTS_CONNECTION_STRING=InstrumentationKey=your-key;IngestionEndpoint=https://eastus-2.in.applicationinsights.azure.com/
LOG_ANALYTICS_WORKSPACE_ID=your-workspace-id
# Enable detailed telemetry (set to false in production for performance)
TELEMETRY_DETAILED=true

# ====================
# OpenAI Configuration
# ====================
OPENAI_API_KEY=sk-proj-your-openai-api-key
OPENAI_MODEL=gpt-4o-mini  # DO NOT CHANGE - System calibrated for this model
OPENAI_TEMPERATURE=1  # DO NOT CHANGE - Required for GPT-4o-mini

# ====================
# Database Configuration
# ====================
# PostgreSQL with pgvector for embeddings
DATABASE_URL=postgresql://username:password@server.postgres.database.azure.com:5432/wellintake?sslmode=require
# Connection pool settings
DATABASE_POOL_SIZE=20
DATABASE_MAX_OVERFLOW=40
DATABASE_POOL_TIMEOUT=30

# ====================
# Azure Storage
# ====================
AZURE_STORAGE_CONNECTION_STRING=DefaultEndpointsProtocol=https;AccountName=wellintakestorage;AccountKey=your-key;EndpointSuffix=core.windows.net
AZURE_CONTAINER_NAME=email-attachments
# Max file size in MB
MAX_FILE_SIZE_MB=25

# ====================
# Redis Cache (Optional for local dev, required for production)
# ====================
REDIS_CONNECTION_STRING=your-redis.redis.cache.windows.net:6380,password=your-password,ssl=True,abortConnect=False
# Cache TTL in seconds
CACHE_TTL=300

# ====================
# Zoho Integration
# ====================
ZOHO_OAUTH_SERVICE_URL=https://well-zoho-oauth-v2.azurewebsites.net
ZOHO_DEFAULT_OWNER_EMAIL=steve.perry@emailthewell.com  # Default owner for email-processed records (must be active recruiter)
ZOHO_API_VERSION=v8  # DO NOT CHANGE - System uses v8 field mappings
ZOHO_API_TIMEOUT=30

# ====================
# External APIs
# ====================
FIRECRAWL_API_KEY=fc-your-firecrawl-api-key
FIRECRAWL_TIMEOUT=5  # Timeout in seconds for company research
SERPER_API_KEY=your-serper-api-key  # Optional, for legacy CrewAI compatibility

# ====================
# Security Configuration
# ====================
# API Key Management
API_KEY_ROTATION_DAYS=30
API_KEY_LENGTH=32

# Rate Limiting
RATE_LIMIT_ENABLED=true
RATE_LIMIT_REQUESTS=100  # Requests per period
RATE_LIMIT_PERIOD=60  # Period in seconds

# CORS Settings
CORS_ORIGINS=["https://outlook.office.com", "https://outlook.office365.com", "https://localhost:3000"]
CORS_ALLOW_CREDENTIALS=true

# Security Headers
SECURITY_HEADERS_ENABLED=true
HSTS_MAX_AGE=31536000

# ====================
# Performance Tuning
# ====================
# Worker configuration
WORKERS=4  # Number of worker processes
WORKER_CONNECTIONS=1000
KEEPALIVE=60
TIMEOUT=30

# Async configuration
ASYNC_MAX_WORKERS=10
ASYNC_QUEUE_SIZE=100

# ====================
# Logging Configuration
# ====================
LOG_LEVEL=INFO  # DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_FORMAT=json  # json or text
LOG_ROTATION_SIZE=10485760  # 10MB
LOG_RETENTION_DAYS=30

# ====================
# Feature Flags (Gradual Rollout)
# ====================
ENABLE_METRICS=true
ENABLE_TRACING=true
ENABLE_PROFILING=false  # Enable only for debugging

# Privacy Features (APPROVED - 2025-10-05)
PRIVACY_MODE=true              # Company anonymization, strict compensation format, location suppression

# AI Features (APPROVED - 2025-10-05)
FEATURE_LLM_SENTIMENT=true      # GPT-5 sentiment analysis with keyword-based fallback
FEATURE_GROWTH_EXTRACTION=true  # Extract "grew 40% YoY" style metrics from transcripts/resumes

# Performance Features (DISABLED - pending async implementation)
FEATURE_ASYNC_ZOHO=false        # Async Zoho API calls (do not enable until call sites are async)

# UX Features (Phase 3 - not implemented)
FEATURE_AUDIENCE_FILTERING=false
FEATURE_CANDIDATE_SCORING=false
ENABLE_AUDIT_LOG=true

# ====================
# Development Settings (Disable in production)
# ====================
DEBUG=false
RELOAD=false  # Auto-reload on code changes
TESTING_MODE=false  # Enables test endpoints

# ====================
# Health Check Configuration
# ====================
HEALTH_CHECK_INTERVAL=30  # Seconds between health checks
HEALTH_CHECK_TIMEOUT=5

# ====================
# Business Rules
# ====================
# Deal name format: "[Job Title] ([Location]) - [Firm Name]"
DEAL_NAME_FORMAT=[{job_title}] ([{location}]) - [{firm_name}]
DEFAULT_LOCATION=Unknown
DEFAULT_JOB_TITLE=Unknown
DEFAULT_FIRM_NAME=Unknown

# ====================
# Email Processing
# ====================
MAX_EMAIL_SIZE_MB=10
ATTACHMENT_ALLOWED_TYPES=pdf,doc,docx,txt,rtf
EMAIL_PROCESSING_TIMEOUT=30

# ====================
# LangGraph Configuration
# ====================
LANGGRAPH_MAX_RETRIES=3
LANGGRAPH_RETRY_DELAY=1
LANGGRAPH_ENABLE_TRACING=true

# ====================
# Deployment Configuration
# ====================
# Container Registry
CONTAINER_REGISTRY=wellintakeregistry.azurecr.io
CONTAINER_IMAGE=well-intake-api
CONTAINER_TAG=latest

# Azure Container Apps
CONTAINER_APP_NAME=well-intake-api
RESOURCE_GROUP=TheWell-Infra-East
LOCATION=eastus

# ====================
# Monitoring Thresholds
# ====================
# Alert thresholds
ERROR_RATE_THRESHOLD=0.05  # 5%
LATENCY_P95_THRESHOLD=5  # seconds
LATENCY_P99_THRESHOLD=10  # seconds
DAILY_COST_THRESHOLD=100  # USD
MEMORY_THRESHOLD_MB=1024  # 1GB

# ====================
# Backup & Recovery
# ====================
BACKUP_ENABLED=true
BACKUP_INTERVAL_HOURS=6
BACKUP_RETENTION_DAYS=30
BACKUP_STORAGE_ACCOUNT=wellintakebackups

# ====================
# Notes
# ====================
# 1. All sensitive values should be stored in Azure Key Vault for production
# 2. Use managed identities instead of connection strings where possible
# 3. Enable Application Insights for comprehensive monitoring
# 4. Configure alerts based on the thresholds above
# 5. Regularly rotate API keys and secrets
# 6. Review and update rate limits based on usage patterns
# 7. Monitor costs daily, especially GPT-4o-mini usage
# 8. Keep this template updated with new configuration options
