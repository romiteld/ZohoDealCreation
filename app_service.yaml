version: 1.0

runtime: python|3.12

build:
  preBuild:
    - echo "Pre-build starting..."
    - python -m pip install --upgrade pip setuptools wheel
    - pip install --no-cache-dir pysqlite3-binary
    - pip install --no-cache-dir numpy==1.26.2
    - pip install --no-cache-dir "langchain-core==0.1.0"
    - pip install --no-cache-dir "langchain==0.1.0"
    - pip install --no-cache-dir "langchain-community==0.0.10"
    - pip install --no-cache-dir "langchain-openai==0.0.5"
    - echo "Pre-build completed"
    
  postBuild:
    - echo "Post-build starting..."
    - python -c "import fastapi; print(f'FastAPI installed: {fastapi.__version__}')"
    - python -c "import crewai; print(f'CrewAI installed: {crewai.__version__}')"
    - chmod +x startup.sh
    - echo "Post-build completed"

env:
  - name: SCM_DO_BUILD_DURING_DEPLOYMENT
    value: "true"
  - name: ENABLE_ORYX_BUILD
    value: "true"
  - name: PYTHON_ENABLE_GUNICORN_MULTIWORKERS
    value: "true"
  - name: WEBSITES_ENABLE_APP_SERVICE_STORAGE
    value: "true"
  - name: __import__hook__
    value: "pysqlite3"
  - name: CHROMA_SQLITE_IMPL
    value: "pysqlite3"

startup: bash startup.sh