<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Well Voice UI - AI-Powered Voice Interface</title>
    
    <!-- Modern Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%234f46e5' stroke-width='2'%3e%3cpath d='M12 2a3 3 0 0 0-3 3v6a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z'/%3e%3cpath d='M19 10v2a7 7 0 0 1-14 0v-2'/%3e%3cline x1='12' y1='19' x2='12' y2='23'/%3e%3cline x1='8' y1='23' x2='16' y2='23'/%3e%3c/svg%3e">
</head>
<body class="dark-theme">
    <div id="app" class="app">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="brand">
                    <div class="brand-icon">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2a3 3 0 0 0-3 3v6a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"/>
                            <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
                            <line x1="12" y1="19" x2="12" y2="23"/>
                            <line x1="8" y1="23" x2="16" y2="23"/>
                        </svg>
                    </div>
                    <div class="brand-text">
                        <h1>Well Voice UI</h1>
                        <span class="brand-subtitle">Azure Speech AI Interface</span>
                    </div>
                </div>
                
                <div class="header-status">
                    <div class="status-indicator" id="connectionStatus">
                        <i class="fas fa-circle"></i>
                        <span>Initializing</span>
                    </div>
                    <button type="button" id="settingsBtn" class="btn btn-icon" title="Settings" aria-label="Settings">
                        <i class="fas fa-cog"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Voice Control Center -->
            <section class="voice-center">
                <div class="voice-panel">
                    <div class="voice-control">
                        <button type="button" id="voiceBtn" class="voice-button" disabled title="Click to start voice recognition" aria-label="Start voice recognition">
                            <div class="voice-icon">
                                <i class="fas fa-microphone"></i>
                                <div class="pulse-ring"></div>
                                <div class="pulse-ring-secondary"></div>
                            </div>
                        </button>
                        
                        <div class="voice-status">
                            <span class="status-text">Click to Start</span>
                            <div class="voice-controls-secondary">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="continuousMode">
                                    <span class="toggle-slider"></span>
                                    <span class="toggle-label">Continuous Mode</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="transcription-section">
                        <div class="transcription-header">
                            <h3>Voice Transcription</h3>
                            <div class="confidence-display">
                                <span id="confidenceText">0%</span>
                                <div class="confidence-bar-container">
                                    <div class="confidence-bar" id="confidenceBar"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="transcription-box" id="transcription">
                            <div class="placeholder">
                                <i class="fas fa-microphone-slash"></i>
                                <span>Voice commands will appear here...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Features Grid -->
            <section class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-brain"></i>
                    </div>
                    <h3>AI-Powered Recognition</h3>
                    <p>Advanced speech recognition using Azure's neural voice models</p>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-language"></i>
                    </div>
                    <h3>Natural Language Processing</h3>
                    <p>Understand complex voice commands and intent recognition</p>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-gauge-high"></i>
                    </div>
                    <h3>Real-Time Processing</h3>
                    <p>Low-latency speech processing with confidence scoring</p>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <h3>Secure & Private</h3>
                    <p>Enterprise-grade security with local processing options</p>
                </div>
            </section>

            <!-- Quick Actions -->
            <section class="quick-actions">
                <h2>Voice Commands</h2>
                <div class="command-grid">
                    <div class="command-card">
                        <div class="command-trigger">"Process email"</div>
                        <div class="command-description">Analyze and extract email data</div>
                    </div>
                    <div class="command-card">
                        <div class="command-trigger">"Open settings"</div>
                        <div class="command-description">Access configuration options</div>
                    </div>
                    <div class="command-card">
                        <div class="command-trigger">"Toggle continuous mode"</div>
                        <div class="command-description">Switch listening modes</div>
                    </div>
                    <div class="command-card">
                        <div class="command-trigger">"Show metrics"</div>
                        <div class="command-description">Display performance data</div>
                    </div>
                </div>
                
                <div class="keyboard-shortcuts">
                    <h3>Keyboard Shortcuts</h3>
                    <div class="shortcuts-list">
                        <div class="shortcut-item">
                            <kbd>Space</kbd>
                            <span>Toggle voice recognition</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Esc</kbd>
                            <span>Stop listening</span>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Login Modal -->
        <div id="loginModal" class="modal active">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>
                        <i class="fab fa-microsoft"></i>
                        Microsoft Authentication Required
                    </h2>
                </div>
                
                <div class="modal-body">
                    <div class="login-form">
                        <div class="microsoft-login-section">
                            <div class="login-description">
                                <i class="fas fa-shield-check"></i>
                                <p>Sign in with your Microsoft account to access the Well Voice UI. This provides secure, enterprise-grade authentication with single sign-on capabilities.</p>
                            </div>
                            
                            <div class="benefits-list">
                                <div class="benefit-item">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Single Sign-On (SSO)</span>
                                </div>
                                <div class="benefit-item">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Enterprise Security</span>
                                </div>
                                <div class="benefit-item">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Multi-Factor Authentication</span>
                                </div>
                            </div>

                            <div class="auth-status" id="authStatus" style="display: none;">
                                <div class="status-content">
                                    <i class="fas fa-spinner fa-spin"></i>
                                    <span id="authStatusText">Initializing authentication...</span>
                                </div>
                            </div>

                            <div class="auth-error" id="authError" style="display: none;">
                                <i class="fas fa-exclamation-triangle"></i>
                                <span id="authErrorText">Authentication service unavailable</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-microsoft" id="microsoftSignInBtn" aria-label="Sign in with Microsoft">
                        <i class="fab fa-microsoft"></i>
                        Sign in with Microsoft
                    </button>
                    <button type="button" class="btn btn-secondary" id="testLoginBtn" style="margin-left: 10px; display: none;" aria-label="Development Test Access">
                        <i class="fas fa-code"></i>
                        Dev Test Access
                    </button>
                </div>
            </div>
        </div>

        <!-- Settings Modal -->
        <div id="settingsModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>
                        <i class="fas fa-cog"></i>
                        Settings
                    </h2>
                    <button type="button" class="modal-close" title="Close" aria-label="Close settings">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="modal-body">
                    <div class="settings-grid">
                        <div class="setting-group">
                            <label for="speechRegion">
                                <i class="fas fa-globe"></i>
                                Speech Service Region
                            </label>
                            <select id="speechRegion">
                                <option value="eastus" selected>East US</option>
                                <option value="westus">West US</option>
                                <option value="westus2">West US 2</option>
                                <option value="centralus">Central US</option>
                                <option value="northcentralus">North Central US</option>
                                <option value="southcentralus">South Central US</option>
                                <option value="eastus2">East US 2</option>
                                <option value="westeurope">West Europe</option>
                                <option value="northeurope">North Europe</option>
                                <option value="southeastasia">Southeast Asia</option>
                                <option value="eastasia">East Asia</option>
                                <option value="australiaeast">Australia East</option>
                                <option value="brazilsouth">Brazil South</option>
                                <option value="canadacentral">Canada Central</option>
                                <option value="centralindia">Central India</option>
                                <option value="japaneast">Japan East</option>
                                <option value="koreacentral">Korea Central</option>
                                <option value="uksouth">UK South</option>
                            </select>
                        </div>
                        
                        <div class="setting-group">
                            <label for="apiEndpoint">
                                <i class="fas fa-link"></i>
                                API Endpoint
                            </label>
                            <input type="text" id="apiEndpoint" 
                                   value="https://well-intake-api.orangedesert-c768ae6e.eastus.azurecontainerapps.io"
                                   placeholder="https://api.example.com">
                        </div>
                        
                        <div class="setting-group">
                            <div class="toggle-setting">
                                <div class="toggle-info">
                                    <label for="autoApprove">
                                        <i class="fas fa-check-circle"></i>
                                        Auto-approve High Confidence
                                    </label>
                                    <p>Automatically approve extractions with confidence > 80%</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="autoApprove">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-group">
                            <div class="toggle-setting">
                                <div class="toggle-info">
                                    <label for="voiceFeedback">
                                        <i class="fas fa-volume-up"></i>
                                        Voice Feedback
                                    </label>
                                    <p>Enable spoken responses for voice commands</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="voiceFeedback" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="document.getElementById('settingsModal').classList.remove('active')" aria-label="Cancel settings">
                        Cancel
                    </button>
                    <button type="button" class="btn btn-primary" id="saveSettings" aria-label="Save settings">
                        <i class="fas fa-save"></i>
                        Save Settings
                    </button>
                </div>
            </div>
        </div>

        <!-- Toast Container -->
        <div id="toastContainer" class="toast-container"></div>
        
        <!-- Loading Overlay -->
        <div id="loadingOverlay" class="loading-overlay">
            <div class="loading-content">
                <div class="loading-spinner">
                    <svg width="50" height="50" viewBox="0 0 50 50">
                        <circle cx="25" cy="25" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-dasharray="31.416" stroke-dashoffset="31.416">
                            <animate attributeName="stroke-array" dur="2s" values="0 31.416;15.708 15.708;0 31.416" repeatCount="indefinite"/>
                            <animate attributeName="stroke-dashoffset" dur="2s" values="0;-15.708;-31.416" repeatCount="indefinite"/>
                        </circle>
                    </svg>
                </div>
                <div class="loading-text">Initializing Azure Speech SDK...</div>
            </div>
        </div>
    </div>

    <!-- Microsoft Authentication Library (MSAL.js) -->
    <script src="https://alcdn.msauth.net/browser/2.38.3/js/msal-browser.min.js"></script>
    
    <!-- Azure Speech SDK - Load with error handling -->
    <script>
        // Check if Azure Speech SDK loads properly
        window.speechSDKLoaded = false;
        window.speechSDKError = null;
        
        // Create script element for Azure Speech SDK with multiple CDN fallbacks
        const speechScript = document.createElement('script');
        speechScript.src = 'https://cdn.jsdelivr.net/npm/microsoft-cognitiveservices-speech-sdk@latest/distrib/browser/microsoft.cognitiveservices.speech.sdk.bundle-min.js';
        
        // Fallback to official CDN if jsdelivr fails
        speechScript.onerror = function() {
            console.warn('Primary CDN failed, trying fallback...');
            const fallbackScript = document.createElement('script');
            fallbackScript.src = 'https://aka.ms/csspeech/jsbrowserpackageraw';
            fallbackScript.onload = speechScript.onload;
            fallbackScript.onerror = function() {
                console.error('All CDN sources failed');
                window.speechSDKError = 'CDN_FAILED';
                showSDKError();
            };
            document.head.appendChild(fallbackScript);
        };
        speechScript.onload = function() {
            console.log('Azure Speech SDK loaded successfully');
            window.speechSDKLoaded = true;
            
            // Hide loading overlay
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) {
                overlay.style.display = 'none';
            }
        };
        
        function showSDKError() {
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) {
                overlay.innerHTML = `
                    <div class="loading-content error">
                        <i class="fas fa-exclamation-triangle"></i>
                        <div class="loading-text">Failed to load Azure Speech SDK</div>
                        <button onclick="location.reload()" class="btn btn-primary">Retry</button>
                    </div>
                `;
            }
        }
        document.head.appendChild(speechScript);
        
        // Fallback timeout
        setTimeout(() => {
            if (!window.speechSDKLoaded && !window.speechSDKError) {
                console.warn('Azure Speech SDK loading timeout');
                const overlay = document.getElementById('loadingOverlay');
                if (overlay) {
                    overlay.innerHTML = `
                        <div class="loading-content error">
                            <i class="fas fa-clock"></i>
                            <div class="loading-text">Azure Speech SDK loading timeout</div>
                            <button onclick="location.reload()" class="btn btn-primary">Retry</button>
                        </div>
                    `;
                }
            }
        }, 10000);
    </script>
    
    <!-- Application Scripts -->
    <script src="config.js"></script>
    <script src="auth-config.js"></script>
    <script src="auth-service.js"></script>
    <script src="voice-handler.js"></script>
    <script src="app.js"></script>
</body>
</html>